<section class="@container p-10 bg-gray-100 font-sans antialiased text-gray-900">
    <div class="grid grid-cols-4 gap-5 @max-sm:grid-cols-1 @max-xl:grid-cols-2 @max-4xl:grid-cols-3">
    @for (product of products; track product._id) {
        <div class="w-full bg-white rounded shadow overflow-hidden transition-all duration-300 transform hover:shadow-xl hover:-translate-y-1 cursor-pointer">
            <!-- Product Image Section -->
            <div class="relative h-72 overflow-hidden bg-gray-100">
                <div [routerLink]="['/detailes', product._id]">
                    <img [src]="product.imageCover" [alt]="product.title" class="w-full h-full object-cover transition-transform duration-700 ease-in-out transform hover:scale-110">
                </div>

                <!-- Sale Badge -->
                @if(product.priceAfterDiscount){
                <div class="absolute top-4 left-4 bg-pink-600 text-white px-3 py-1.5 rounded text-xs font-bold uppercase tracking-wider">
                    <span>Sale</span>
                </div>
                }

                <!-- Wishlist Button -->
                <button (click)="addToFav(product._id); $event.stopPropagation()"
                    class="absolute top-4 right-4 bg-white bg-opacity-90 rounded-full w-10 h-10 flex items-center justify-center shadow-sm transition-colors duration-200 hover:bg-opacity-100 focus:outline-none hover:bg-blue-50 "
                >
                  <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 21.35L10.55 20.03C5.4 15.36 2 12.28 2 8.5C2 5.42 4.42 3 7.5 3C9.24 3 10.91 3.81 12 5.09C13.09 3.81 14.76 3 16.5 3C19.58 3 22 5.42 22 8.5C22 12.28 18.6 15.36 13.45 20.03L12 21.35Z" fill="#A7C7E7"/>
                  </svg>
                </button>
                <!-- <button (click)="addToFav(product._id); $event.stopPropagation()"
                    class="absolute top-4 right-4 bg-white bg-opacity-90 rounded-full w-10 h-10 flex items-center justify-center shadow-sm transition-colors duration-200 hover:bg-opacity-100 focus:outline-none focus:ring-2 focus:ring-pink-500 focus:ring-offset-2"
                    [class.text-pink-500]="isFavorite(product._id)"
                >
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6"
                          [fill]="isFavorite(product._id) ? 'currentColor' : 'none'"
                          viewBox="0 0 24 24"
                          stroke="currentColor"
                          stroke-width="2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" />
                    </svg>
                </button> -->
            </div>

            <!-- Product Details Section -->
            <div class="p-6">
                <!-- Category -->
                <div class="text-indigo-600 text-sm font-semibold uppercase tracking-wide mb-1">{{product.category.name}}</div>

                <!-- Title -->
                <h2 [routerLink]="['/detailes', product._id]" class="text-2xl font-bold text-gray-900 leading-tight mb-2 line-clamp-1">{{product.title}}</h2>

                <!-- Rating -->
                @if(product.ratingsAverage !== 0){
                <div class="flex items-center mb-2">
                    <div class="flex text-yellow-400">
                        @for (star of [].constructor(Math.floor(product.ratingsAverage)); track $index) {
                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" class="size-6 text-yellow-500">
                            <path fill-rule="evenodd" d="M10.788 3.21c.448-1.077 1.976-1.077 2.424 0l2.082 5.006 5.404.434c1.164.093 1.636 1.545.749 2.305l-4.117 3.527 1.257 5.273c.271 1.136-.964 2.033-1.96 1.425L12 18.354 7.373 21.18c-.996.608-2.231-.29-1.96-1.425l1.257-5.273-4.117-3.527c-.887-.76-.415-2.212.749-2.305l5.404-.434 2.082-5.005Z" clip-rule="evenodd" />
                        </svg>
                        }
                    </div>
                    <span class="text-gray-500 text-sm ml-2">{{product.ratingsQuantity}} reviews</span>
                </div>
                }

                <!-- Price and CTA -->
<!-- Price and CTA Section - Improved Version -->
<div class="flex items-center justify-between mt-4">
    <!-- Price Display -->
    <div class="flex flex-col">
        <!-- Original Price (when on sale) -->
        @if(product.priceAfterDiscount) {
        <div class="text-gray-400 line-through text-sm">
            {{product.price}} EGP
        </div>
        }

        <!-- Current Price -->
        <div class="flex items-center gap-2">
            <span class="text-2xl font-bold text-gray-900">
                @if(product.priceAfterDiscount) {
                    {{product.priceAfterDiscount}}
                } @else {
                    {{product.price}}
                } EGP
            </span>

            <!-- Discount Badge -->
            @if(product.priceAfterDiscount) {
            <span class="bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded-full">
                Save {{calculateDiscountPercentage(product.price, product.priceAfterDiscount)}}%
            </span>
            }
        </div>
    </div>

    <!-- Cart Icon Button -->
    <button (click)="addProductToCart(product._id); $event.stopPropagation()"
            class="p-3 bg-blue-50 hover:bg-blue-100 rounded-full transition-colors duration-200">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" viewBox="0 0 20 20" fill="currentColor">
            <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3z" />
            <path d="M16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z" />
        </svg>
    </button>
</div>
            </div>
        </div>
    }
    <!-- @empty {
            <div class="flex items-center justify-center min-h-[200px] p-6 bg-gray-100 rounded-lg shadow-md m-4 sm:m-6 md:m-8">
        <div class="text-center">
          <p class="text-3xl sm:text-4xl font-bold text-gray-700 mb-4">
            No Products Found
          </p>
          <p class="text-lg sm:text-xl text-gray-600 mb-4">
            It looks like there are no products in this category yet.
          </p>
          <span class="text-6xl sm:text-7xl" role="img" aria-label="Sad face emoji">
            ðŸ˜”
          </span>
          <p class="text-sm text-gray-500 mt-4">
            Please check back later or explore other categories.
          </p>
        </div>
      </div>
    } -->
    </div>
</section>
