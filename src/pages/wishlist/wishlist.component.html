<section class="@container p-10 bg-gray-100 font-sans antialiased text-gray-900">
    <div class="grid grid-cols-4 gap-5 @max-sm:grid-cols-1 @max-xl:grid-cols-2 @max-4xl:grid-cols-3">
    @for (product of wishlistData(); track product._id) {
        <div class="w-full bg-white rounded shadow overflow-hidden transition-all duration-300 transform hover:shadow-xl hover:-translate-y-1 cursor-pointer">
            <!-- Product Image Section -->
            <div class="relative h-72 overflow-hidden bg-gray-100">
                <div [routerLink]="['/detailes', product._id]">
                    <img [src]="product.imageCover" [alt]="product.title" class="w-full h-full object-cover transition-transform duration-700 ease-in-out transform hover:scale-110">
                </div>
                <!-- Sale Badge -->
                @if(product.priceAfterDiscount){
                <div class="absolute top-4 left-4 bg-pink-600 text-white px-3 py-1.5 rounded text-xs font-bold uppercase tracking-wider">
                    <span>Sale</span>
                </div>
                }

                <!-- Wishlist Button -->
                <button (click)="removeFromMyWishlist(product._id); $event.stopPropagation()"
                    class="absolute top-4 right-4 bg-white bg-opacity-90 rounded-full w-10 h-10 flex items-center justify-center shadow-sm transition-colors duration-200 hover:bg-opacity-100 focus:outline-none hover:bg-blue-50 "
                >
                    <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M3 6H21" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M19 6V20C19 21.1046 18.1046 22 17 22H7C5.89543 22 5 21.1046 5 20V6M8 6V4C8 3.44772 8.44772 3 9 3H15C15.5523 3 16 3.44772 16 4V6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M10 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                      <path d="M14 11V17" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </button>
            </div>

            <!-- Product Details Section -->
            <div class="p-6">
                <!-- Category -->
                <div class="text-indigo-600 text-sm font-semibold uppercase tracking-wide mb-1">{{product.category.name}}</div>

                <!-- Title -->
                <h2 [routerLink]="['/detailes', product._id]" class="text-2xl font-bold text-gray-900 leading-tight mb-2 line-clamp-1">{{product.title}}</h2>
                <!-- Price and CTA -->
                <!-- Price and CTA Section - Improved Version -->
                <div class="flex items-center justify-between mt-4">
                    <!-- Price Display -->
                    <div class="flex flex-col">
                        <!-- Original Price (when on sale) -->
                        @if(product.priceAfterDiscount) {
                        <div class="text-gray-400 line-through text-sm">
                            {{product.price}} EGP
                        </div>
                        }

                        <!-- Current Price -->
                        <div class="flex items-center gap-2">
                            <span class="text-2xl font-bold text-gray-900">
                                @if(product.priceAfterDiscount) {
                                    {{product.priceAfterDiscount}}
                                } @else {
                                    {{product.price}}
                                } EGP
                            </span>

                            <!-- Discount Badge -->
                            @if(product.priceAfterDiscount) {
                            <span class="bg-green-100 text-green-800 text-xs font-medium px-2 py-1 rounded-full">
                                Save {{calculateDiscountPercentage(product.price, product.priceAfterDiscount)}}%
                            </span>
                            }
                        </div>
                    </div>

                    <!-- Cart Icon Button -->
                    <button (click)="addProductToCart(product._id); $event.stopPropagation()"
                            class="p-3 bg-blue-50 hover:bg-blue-100 rounded-full transition-colors duration-200">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-blue-600" viewBox="0 0 20 20" fill="currentColor">
                            <path d="M3 1a1 1 0 000 2h1.22l.305 1.222a.997.997 0 00.01.042l1.358 5.43-.893.892C3.74 11.846 4.632 14 6.414 14H15a1 1 0 000-2H6.414l1-1H14a1 1 0 00.894-.553l3-6A1 1 0 0017 3H6.28l-.31-1.243A1 1 0 005 1H3z" />
                            <path d="M16 16.5a1.5 1.5 0 11-3 0 1.5 1.5 0 013 0zM6.5 18a1.5 1.5 0 100-3 1.5 1.5 0 000 3z" />
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    }
    </div>
</section>
